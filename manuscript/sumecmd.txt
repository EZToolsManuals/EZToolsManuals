# SumECmd

## SumECmd Introduction

SumECmd is a tool created by Eric Zimmerman used to parse the SUM database. The SUM database is located at `C:\Windows\System32\LogFiles\SUM` where multiple `*.mdb` files can be located.

### SumECmd Use Cases

#### Law Enforcement

For those in Law Enforcement, SumECmd may not have an immediate use unless the system(s) being analyzed is attached to a domain. The SUM database can provide authentication history within a Domain, IP resolution within the Domain, and the first and last time an account has been authenticated within a Domain.

#### Private Sector

For those in the Private Sector, SumECmd can provide helpful information regarding which compromised accounts have authenticated where and when within a Domain. Additionally, having visibility into the DNS history of a Domain for the current year and previous 2 years is incredibly helpful when trying to figure out which IP address resolved to which host when.

{pagebreak}

## SumECmd Switches

In a PowerShell window, running `.\SumECmd.exe` will provide the following options when running SumECmd:

{line-numbers:false}
```powershell
Description:
  SumECmd version 0.5.2.0

  Author: Eric Zimmerman (saericzimmerman@gmail.com)
  https://github.com/EricZimmerman/Sum

  Examples: SumECmd.exe -d "C:\Temp\sum" --csv "C:\Temp\"

             Short options (single letter) are prefixed with a single dash. Long commands are
  prefixed with two dashes


Usage:
  SumECmd [options]

Options:
  -d <d>          Directory to process, looking for SystemIdentity.mdb, Current.mdb, etc.
                  Required.
  --csv <csv>     Directory to save CSV formatted results to. Be sure to include the full
                  path in double quotes
  --wd            Generate CSV with day level details. Default is TRUE [default: True]
  --dt <dt>       The custom date/time format to use when displaying time stamps. See
                  https://goo.gl/CNVq0k for options [default: yyyy-MM-dd HH:mm:ss]
  --debug         Show debug information during processing [default: False]
  --trace         Show trace information during processing [default: False]
  --version       Show version information
  -?, -h, --help  Show help and usage information


-d is required. Exiting
```

### Switch Descriptions

#### `--wd`

This switch will generate CSVs with day level details. This means an extra CSV will be generated named `TIMESTAMP_SumECmd_DETAIL_ClientsDetailed_Output.csv`. When running SumECmd with `--wd false`, this CSV will not generate.

Example: `.\SumECmd.exe -d "D:\Test\SUM" --csv "D:\temp" --wd`

<!-- All other switches are covered by eztools_commonswitches.txt - 2022-09-15 -->

{pagebreak}

## SumECmd Command Examples

### Example SumECmd Commands

#### Parse the SUM database and output CSVs to a specified location

{line-numbers:false}
```powershell
SumECmd.exe -d "C:\Temp\sum" --csv "C:\Temp\"
```

{pagebreak}

## SumECmd Output

### Analyzing SumECmd Output - CSV

SumECmd will output the following CSVs when ran against a Domain Controller's SUM database with the ADDS (Active Directory Domain Services) role assigned to it:

`%timestamp%_SumECmd_DETAIL_Clients_Output.csv`
`%timestamp%_SumECmd_DETAIL_ClientsDetailed_Output.csv`
`%timestamp%_SumECmd_DETAIL_DnsInfo_Output.csv`
`%timestamp%_SumECmd_DETAIL_RoleAccesses_Output.csv`
`%timestamp%_SumECmd_SUMMARY_ChainedDbInfo_Output.csv`
`%timestamp%_SumECmd_SUMMARY_RoleInfos_Output.csv`
`%timestamp%_SumECmd_SUMMARY_SystemIdentInfo_Output.csv`

If a Domain Controller does NOT have the ADDS role assigned to it, you will still see the above output, but you likely will not see the DnsInfo output.

#### `%timestamp%_SumECmd_DETAIL_Clients_Output.csv`

This output is useful for helping examiners observe which accounts authenticated where within a given domain. Insert Date and Last Access can be interpreted as the first and last time an account authenticated to the IP Address listed in the column of the same name.

#### `%timestamp%_SumECmd_DETAIL_ClientsDetailed_Output.csv`

This output will provide a different look at the most of the same info from the output mentioned above. Between this output and the above output, examiners can glean good insight as to which accounts authenticated where, when, and how many times along with an idea of when the first and last authentication occurred.

#### `%timestamp%_SumECmd_DETAIL_DnsInfo_Output.csv`

This output is incredibly useful for providing the examiner with historical DNS information within the domain. If an examiner needs to know which host a certain IP address resolves to within a domain, first locate a Domain Controller that has the ADDS role assigned (often trial and error) and locate this table's output!

As a protip, in Timeline Explorer, sort ascending on the hostname and then secondary sort (hold down shift while clicking on the next column you want to sort on) on Last Seen. This will give you a great overview of which hosts had which IP addresses when.

#### `%timestamp%_SumECmd_DETAIL_RoleAccesses_Output.csv`

This output will provide examiners with an idea of which roles were assigned to the Windows Server endpoints within a given domain along with their Role GUIDs.

#### `%timestamp%_SumECmd_SUMMARY_ChainedDbInfo_Output.csv`

This output will provide examiners with an idea of which calendar years are covered within the SUM database for a Domain Controller within a given domain. Please note, that the second a Domain Controller connects to a domain for the first time, it will only have information from that point forward. It will not inherit historical information within the domain prior to the time of host coming online within the domain.

{pagebreak}

## SumECmd References

### Associated GitHub Repositories

* <https://github.com/EricZimmerman/Sum> is the GitHub repository for SumECmd

### Blog Posts

#### Community Resources

* <https://advisory.kpmg.us/blog/2021/digital-forensics-incident-response.html>
* <https://svch0st.medium.com/windows-user-access-logs-ual-9580f1100635>

### Download SumECmd

SumECmd can be downloaded from <https://ericzimmerman.github.io/#!index.md>

### SUM Sample Data

Sample SUM artifacts can be found at the [DFIRArtifactMuseum](https://github.com/AndrewRathbun/DFIRArtifactMuseum/tree/main/Windows/SUM).
