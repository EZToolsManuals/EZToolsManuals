# AppCompatCacheParser

## AppCompatCacheParser Introduction

AppCompatCacheParser is a tool created by Eric Zimmerman used to parse the AppCompatCache, commonly referred to as the ShimCache, which can be found in the SYSTEM hive.

### Understanding the Artifact: AppCompatCache

TODO

{pagebreak}

## AppCompatCacheParser Switches

In a PowerShell window, running `.\AppCompatCacheParser.exe` will provide the following options when running AppCompatCacheParser:

{line-numbers:false}
```powershell
Description:
  AppCompatCache Parser version 1.5.0.0

  Author: Eric Zimmerman (saericzimmerman@gmail.com)
  https://github.com/EricZimmerman/AppCompatCacheParser

  Examples: AppCompatCacheParser.exe --csv c:\temp -t -c 2
            AppCompatCacheParser.exe --csv c:\temp --csvf results.csv

            Short options (single letter) are prefixed with a single dash. Long commands are
  prefixed with two dashes


Usage:
  AppCompatCacheParser [options]

Options:
  -f <f>                  Full path to SYSTEM hive to process. If this option is not
                          specified, the live Registry will be used
  --csv <csv> (REQUIRED)  Directory to save CSV formatted results to. Be sure to include the
                          full path in double quotes
  --csvf <csvf>           File name to save CSV formatted results to. When present, overrides 
                          default name
  --c <c>                 The ControlSet to parse. Default is to extract all control sets
                          [default: -1]
  -t                      Sorts last modified timestamps in descending order [default: False]
  --dt <dt>               The custom date/time format to use when displaying time stamps. See 
                          https://goo.gl/CNVq0k for options [default: yyyy-MM-dd HH:mm:ss]
  --nl                    When true, ignore transaction log files for dirty hives [default:
                          False]
  --debug                 Show debug information during processing [default: False]
  --trace                 Show trace information during processing [default: False]
  --version               Show version information
  -?, -h, --help          Show help and usage information
```

### Switch Descriptions

#### `-c`

This switch informs the tool to parse a specific ControlSet. The default is to parse all ControlSets specified within the Registry.

Example: `.\AppCompatCacheParser.exe -f "C:\temp\System" --csv C:\temp\appcompatcachetest --c 1`

The above command will display the following message in the console window:

```
Found 1,024 cache entries for Windows10Creators in ControlSet001

Results saved to 'C:\temp\appcompatcachetest\20220805212738_Windows10Creators_System_ControlSet001_AppCompatCache.csv'
```

#### `-t`

This switch IS NOT CURRENTLY WORKING

Example: ``

#### `-nl`

This switch will inform the tool whether to replay transaction logs or not.

Below is an exmaple of replaying transaction logs:

Example: `.\AppCompatCacheParser.exe -f "D:\temp\SYSTEM" --nl false --csv "D:\temp"`

When processing transaction logs, you will see a message similar to this:

```
Two transaction logs found. Determining primary log...
Primary log: D:\temp\SYSTEM.LOG2, secondary log: D:\temp\SYSTEM.LOG1
Replaying log file: D:\temp\SYSTEM.LOG2
Replaying log file: D:\temp\SYSTEM.LOG1
At least one transaction log was applied. Sequence numbers have been updated to 0x91DD. New Checksum: 0xAD729723
Found 1,024 cache entries for Windows10Creators in ControlSet001
```

Below is an example of ignoring transaction logs:

Example: `.\AppCompatCacheParser.exe -f "D:\temp\SYSTEM" --nl true --csv "D:\temp"`

When ignoring transaction logs, you will see a message similar to this:

```
Registry hive is dirty and transaction logs were found in the same directory, but --nl was provided. Data may be missing! Continuing anyways...
Sequence numbers do not match! Hive is dirty and the transaction logs should be reviewed for relevant data!
Found 1,024 cache entries for Windows10Creators in ControlSet001
```

{pagebreak}

## AppCompatCacheParser Command Examples

### Example AppCompatCacheParser Commands

#### Parse the AppCompatCache from the SYSTEM Registry hive and output to a specified location while only parsing ControlSet2

{line-numbers:false}
```powershell
AppCompatCacheParser.exe --csv c:\temp -c 2

```

#### Parse the AppCompatCache from the SYSTEM Registry hive and output to a specified location while outputting a CSV named results.csv

{line-numbers:false}
```powershell
AppCompatCacheParser.exe --csv c:\temp --csvf results.csv
```

{pagebreak}

## AppCompatCacheParser Output

### Analyzing AppCompatCacheParser Output - CSV

{pagebreak}

## AppCompatCacheParser Sample Output

{pagebreak}

## AppCompatCacheParser Key Takeaways

### Important Data Points

{pagebreak}

## AppCompatCacheParser References

### Associated GitHub Repositories

* <https://github.com/EricZimmerman/JumpList> is the C# library for parsing JumpList files 
* <https://github.com/EricZimmerman/OleCf> is the C# library for parsing OLE compound files, which Jump Lists are
* <https://github.com/EricZimmerman/JLECmd> is the Command Line wrapper for the JumpList library

### Blog Posts

#### Official Blog Posts

Blog posts from Eric Zimmerman’s blog, Binary Foray:

* <https://binaryforay.blogspot.com/2015/05/introducing-appcompatcacheparser.html>
* <https://binaryforay.blogspot.com/2015/05/appcompatcacheparser-v0051-released.html>
* <https://binaryforay.blogspot.com/2015/05/appcompatcacheparser-v0052-released.html>
* <https://binaryforay.blogspot.com/2016/05/appcompatcacheparser-v0900-released-and.html>
* <https://binaryforay.blogspot.com/2017/03/windows-10-creators-update-vs-shimcache.html>
* <https://binaryforay.blogspot.com/2018/03/updates-to-left-of-me-updates-to-right.html>
* <https://binaryforay.blogspot.com/2018/09/everything-gets-update-sept-2018-edition.html>
* <https://binaryforay.blogspot.com/2019/01/locked-file-support-added-to.html>

#### Community Resources

* <https://youtu.be/ZKlyu-HOvxY>
* <https://youtu.be/7byz1dR_CLg>

### Download AppCompatCacheParser

AppCompatCacheParser can be downloaded from <https://ericzimmerman.github.io/#!index.md>
