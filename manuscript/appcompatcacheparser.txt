# AppCompatCacheParser

## AppCompatCacheParser Introduction

AppCompatCacheParser is a tool created by Eric Zimmerman used to parse the AppCompatCache, commonly referred to as the ShimCache, which can be found in the SYSTEM hive.

<!-- TODO: need to expand this -->
<!-- TODO: need to use DFIRArtifactMuseum paths in commands used in Switch Descriptions section -->

{pagebreak}

## AppCompatCacheParser Switches

In a PowerShell window, running `.\AppCompatCacheParser.exe` will provide the following options when running AppCompatCacheParser:

{line-numbers:false}
```powershell
Description:
  AppCompatCache Parser version 1.5.0.0

  Author: Eric Zimmerman (saericzimmerman@gmail.com)
  https://github.com/EricZimmerman/AppCompatCacheParser

  Examples: AppCompatCacheParser.exe --csv c:\temp -t -c 2
            AppCompatCacheParser.exe --csv c:\temp --csvf results.csv

            Short options (single letter) are prefixed with a single dash. Long commands are
  prefixed with two dashes


Usage:
  AppCompatCacheParser [options]

Options:
  -f <f>                  Full path to SYSTEM hive to process. If this option is not
                          specified, the live Registry will be used
  --csv <csv> (REQUIRED)  Directory to save CSV formatted results to. Be sure to include the
                          full path in double quotes
  --csvf <csvf>           File name to save CSV formatted results to. When present, overrides
                          default name
  --c <c>                 The ControlSet to parse. Default is to extract all control sets
                          [default: -1]
  -t                      Sorts last modified timestamps in descending order [default: False]
  --dt <dt>               The custom date/time format to use when displaying time stamps. See
                          https://goo.gl/CNVq0k for options [default: yyyy-MM-dd HH:mm:ss]
  --nl                    When true, ignore transaction log files for dirty hives [default:
                          False]
  --debug                 Show debug information during processing [default: False]
  --trace                 Show trace information during processing [default: False]
  --version               Show version information
  -?, -h, --help          Show help and usage information
```

### Switch Descriptions

#### `-c`

This switch informs the tool to parse a specific ControlSet. The default is to parse all ControlSets specified within the Registry.

Example: `.\AppCompatCacheParser.exe -f "C:\temp\System" --csv C:\temp\appcompatcachetest --c 1`

The above command will display the following message in the console window:

```
Found 1,024 cache entries for Windows10Creators in ControlSet001

Results saved to 'C:\temp\appcompatcachetest\20220805212738_Windows10Creators_System_ControlSet001_AppCompatCache.csv'
```

#### `-t`

This switch will inform the tool to sort the last modified timestamps in descending order.

Example: `.\AppCompatCacheParser.exe -f "D:\temp\SYSTEM" --nl false --csv "D:\temp" -t`

#### `-nl`

This switch will inform the tool whether to replay transaction logs or not.

Below is an exmaple of replaying transaction logs:

Example: `.\AppCompatCacheParser.exe -f "D:\temp\SYSTEM" --nl false --csv "D:\temp"`

When processing transaction logs, you will see a message similar to this:

```
Two transaction logs found. Determining primary log...
Primary log: D:\temp\SYSTEM.LOG2, secondary log: D:\temp\SYSTEM.LOG1
Replaying log file: D:\temp\SYSTEM.LOG2
Replaying log file: D:\temp\SYSTEM.LOG1
At least one transaction log was applied. Sequence numbers have been updated to 0x91DD. New Checksum: 0xAD729723
Found 1,024 cache entries for Windows10Creators in ControlSet001
```

Below is an example of ignoring transaction logs:

Example: `.\AppCompatCacheParser.exe -f "D:\temp\SYSTEM" --nl true --csv "D:\temp"`

When ignoring transaction logs, you will see a message similar to this:

```
Registry hive is dirty and transaction logs were found in the same directory, but --nl was provided. Data may be missing! Continuing anyways...
Sequence numbers do not match! Hive is dirty and the transaction logs should be reviewed for relevant data!
Found 1,024 cache entries for Windows10Creators in ControlSet001
```

{pagebreak}

## AppCompatCacheParser Command Examples

### Example AppCompatCacheParser Commands

#### Parse the AppCompatCache from the SYSTEM Registry hive and output to a specified location while only parsing ControlSet2

{line-numbers:false}
```powershell
AppCompatCacheParser.exe --csv c:\temp -c 2

```

#### Parse the AppCompatCache from the SYSTEM Registry hive and output to a specified location while outputting a CSV named results.csv

{line-numbers:false}
```powershell
AppCompatCacheParser.exe --csv c:\temp --csvf results.csv
```

<!-- All other switches are covered by eztools_commonswitches.txt - 2022-09-15 -->

{pagebreak}

## AppCompatCacheParser Output

### Analyzing AppCompatCacheParser Output - CSV

AppCompatCacheParser will output a filename similar to these:

`%timestamp%_XXXXXX_SYSTEM_AppCompatCache.csv`

According to [AppCompatCacheParser's code](https://github.com/EricZimmerman/AppCompatCacheParser/blob/95d4e1e084fdf8289175fdb47a15747753ec8e77/AppCompatCache/AppCompatCache.cs#L56), the following versions can replace the XXXXXX:

```
WindowsXP,
WindowsVistaWin2k3Win2k8,
Windows7x86,
Windows7x64_Windows2008R2,
Windows80_Windows2012,
Windows81_Windows2012R2,
Windows10,
Windows10Creators,
Unknown
```

{pagebreak}

## AppCompatCacheParser Key Takeaways

### Important Data Points

The Last Modified timestamp will not be the last time of execution, rather, it'll be the last modified timestamp of the file itself. In some instances, this timestamp could be similar to a file's execution as seen elsewhere in UserAssist, Prefetch, etc. In that scenario, consider the file may have been copied from elsewhere and then executed immediately upon the file copy operation's completion. With the file being copied, the last modified timestamp will reflect the time of the file copy operation's completion, which being immediately followed by executing the file could make the last modified timestamp found in the AppCompatCache seem like a reliable timestamp, in some cases. Ideally, rely on other artifacts for more reliable evidence of execution timestamps.

{pagebreak}

## AppCompatCacheParser References

### Associated GitHub Repositories

* <https://github.com/EricZimmerman/JumpList> is the C# library for parsing JumpList files
* <https://github.com/EricZimmerman/OleCf> is the C# library for parsing OLE compound files, which Jump Lists are
* <https://github.com/EricZimmerman/JLECmd> is the Command Line wrapper for the JumpList library

### Blog Posts

#### Official Blog Posts

Blog posts from Eric Zimmerman’s blog, Binary Foray:

* <https://binaryforay.blogspot.com/2015/05/introducing-appcompatcacheparser.html>
* <https://binaryforay.blogspot.com/2015/05/appcompatcacheparser-v0051-released.html>
* <https://binaryforay.blogspot.com/2015/05/appcompatcacheparser-v0052-released.html>
* <https://binaryforay.blogspot.com/2016/05/appcompatcacheparser-v0900-released-and.html>
* <https://binaryforay.blogspot.com/2017/03/windows-10-creators-update-vs-shimcache.html>
* <https://binaryforay.blogspot.com/2018/03/updates-to-left-of-me-updates-to-right.html>
* <https://binaryforay.blogspot.com/2018/09/everything-gets-update-sept-2018-edition.html>
* <https://binaryforay.blogspot.com/2019/01/locked-file-support-added-to.html>

#### Community Resources

* <https://youtu.be/ZKlyu-HOvxY>
* <https://youtu.be/7byz1dR_CLg>

### Download AppCompatCacheParser

AppCompatCacheParser can be downloaded from <https://ericzimmerman.github.io/#!index.md>

### AppCompatCache Sample Data

Sample data for the AppCompatCache can be found in the DFIRArtifactMuseum [here](https://github.com/AndrewRathbun/DFIRArtifactMuseum/tree/main/Windows/AppCompatCache).
